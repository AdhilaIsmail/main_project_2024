{% extends 'baselab.html' %}
{% block content %}

{% load static %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Add Bing Maps API Script -->
<script type="text/javascript" src="https://www.bing.com/api/maps/mapcontrol?key=Agyr0UQGWTFzP3Fwb3PDJ_ahP24jx9jRgpUWwBD_37B8MXu1oql6WCs6J-vgU1YT"></script>
<style>
    .btn-container 
    {
        margin-right: 10px; /* Adjust the margin between buttons if needed */
    }
    .icon-box 
    {
        background-color: white;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .map-container-hidden {
        display: none;
    }
    
    .special-packages-section 
    {
        background-color: #f8f9fa;
        padding: 60px 0;
    }
    .special-package-item 
    {
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin: 0 10px;
        transition: transform 0.3s ease-in-out;
    }
   .special-packages-carousel .carousel-inner 
    {
        display: flex;
        flex-wrap: nowrap;
    }
    .special-packages-carousel .carousel-item 
    {
        width: calc(100% / 3); /* Show only 3 items at a time */
        overflow: hidden;
    }

    .test-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .test-box {
        flex: 0 0 30%; /* Adjust the width as needed */
        border: 1px solid #ccc;
        padding: 15px;
        margin: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        background-color: #fff;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .test-box h3 {
        margin-bottom: 10px;
        color: #333;
    }

    .test-box p {
        color: #777;
    }

    .know-more-btn {
        margin-top: auto; /* Move the button to the bottom */
        background-color: #007bff;
        color: #fff;
        padding: 8px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .know-more-btn:hover {
        background-color: #0056b3;
    }
    .carousel-item 
    {
        display: flex;
        justify-content: space-between;
    }
    .test-box 
    {
        width: calc(32% - 10px); /* 32% width for each box with some margin in between */
        margin-bottom: 20px;
    }
    #myMap {
        display: none;
    }
    #mapContainer {
        width: 90%;
        height: 500px;
        margin: auto;
        margin-top: 20px; /* Adjust margin-top as needed */
        display: none; /* Initially hide map container */
    }
</style>

    <!-- Full Screen Search Start -->
    <div class="modal fade" id="searchModal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content" style="background: rgba(192, 109, 109, 0.7);">
                <div class="modal-header border-0">
                    <button type="button" class="btn bg-white btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body d-flex align-items-center justify-content-center">
                    <div class="input-group" style="max-width: 600px;">
                        <input type="text" class="form-control bg-transparent border-primary p-3" placeholder="Type search keyword">
                        <button class="btn btn-primary px-4"><i class="bi bi-search"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Full Screen Search End -->

    <!-- Carousel Start -->
    <div class="container-fluid p-0">
        <div id="header-carousel" class="carousel slide carousel-fade" data-bs-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active position-relative">
                    <img class="w-100" src="{% static 'img/lab.png' %} " alt="Image">
                    <div class="carousel-caption-lab d-flex flex-column align-items-start justify-content-center position-absolute top-50 start-0 translate-middle-y p-3 ms-auto" style="background-color: transparent;">
                        <div class="p-5" style="width: 1100px;">
                            <div class="container py-5">
                                <div class="row">
                                    <div class="col-lg-8">
                                        {% comment %} <div class="input-group mb-3"> {% endcomment %}
                                            {% comment %} <input type="text" class="form-control form-control-lg" placeholder="Type here..."> {% endcomment %}
                                            {% comment %} <input type="text" class="form-control bg-transparent border-primary p-3" name="q" id="searchInput" placeholder="Type search keyword" value="{{ query }}">
                                            <button class="btn btn-primary" id="searchButton">Search</button>
                                        </div> {% endcomment %}
                                        <div class="input-group mb-3">
                                            <input type="text" class="form-control bg-transparent border-primary p-3" name="q" id="searchInput" placeholder="Type search keyword" value="{{ query }}">
                                            <button class="btn btn-primary" id="searchButton">Search</button>
                                            <div id="searchResults" class="dropdown-menu" style="display: none;"></div>
                                        </div>
                                        <div class="d-flex justify-content-start">


                                            <div class="btn-container">
                                                <a href="{% url 'upload_prescription_view' %}" class="btn btn-primary me-2 text-center" role="button" style="background-color:#294e65; height:70px; display: flex; align-items: center; justify-content: center;">
                                                    <div class="icon-box" style="height: 50px; width: 50px; border-radius:5px;">
                                                        <img src="{% static 'img/presciptionlogo.svg' %}" alt="Upload Icon" style="height: 20px;">
                                                    </div>
                                                    Upload Prescription
                                                </a>
                                            </div>

                                           
                                            <div class="btn-container">
                                                <button id="downloadReportButton" class="btn btn-primary me-2 text-center" style="background-color:#294e65; height:70px; display: flex; align-items: center; justify-content: center;">
                                                  <div class="icon-box" style="height: 50px; width: 50px; border-radius:5px;">
                                                    <img src="{% static 'img/labreportlogo.svg' %}" alt="Download Icon" style="height: 20px;">
                                                  </div>
                                                  Download Report
                                                </button>
                                            </div>
                                              
                                        
                                            <div class="container">
                                                <div class="btn-container">
                                                    <a id="findLabButton" href="#" class="btn btn-primary me-2 text-center" role="button" style="background-color:#294e65; height:70px; display: flex; align-items: center; justify-content: center;">
                                                        <div class="icon-box" style="height: 50px; width: 50px; border-radius:5px;">
                                                            <img src="{% static 'img/lablogo1.svg' %}" alt="Find Lab Icon" style="height: 20px;">
                                                        </div>
                                                        Find Our Lab
                                                    </a>
                                                </div>
                                            </div>
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                           
                        </div>
                    </div>
                </div>
                
            </div>
            
        </div>
    </div>
    <div class="container-fluid col-12 d-flex justify-content-center bg-dark">
        <div id="mapContainer" class="map"></div>
    </div>
    <!-- Carousel End -->
    <div class="modal fade" id="downloadReportModal" tabindex="-1" aria-labelledby="downloadReportModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="downloadReportModalLabel">Download Report</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="downloadReportForm" method="POST" action="{% url 'download_report_by_phone' %}">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="phoneNumber" class="form-label">Phone Number</label>
                            <input type="text" class="form-control" id="phoneNumber" name="phoneNumber" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <h2 class="text-center mb-5">Specialized Health Packages</h2>
        <div class="test-container">
            {% if lab_tests_page %}
                {% for test in lab_tests_page %}
                    {% comment %} <div class="test-box">
                        <h3>{{ test.test_name }}</h3>
                        <p>Price: ${{ test.test_price }}</p>
                        <button class="know-more-btn">Know More</button>
                    </div> {% endcomment %}
                    <div class="test-box">
                        <h3>{{ test.test_name }}</h3>
                        <p>Price: ${{ test.test_price }}</p>
                        <a href="{% url 'show_test_details' test.id %}" class="know-more-btn">Know More</a>
                    </div>
                {% endfor %}
            {% else %}
                <p>No results found.</p>
                
            {% endif %}
        </div>
    </div>
    {% comment %} <div id="mapContainer" class="container-fluid col-12 d-flex justify-content-center bg-dark" style="display: none;">
        <div class="map" id="myMap" style="width: 90%; height: 500px;"></div>
    </div> {% endcomment %}

    <!-- Testimonial Start -->
    <div class="container-fluid bg-primary bg-testimonial py-5 my-5 wow fadeInUp" data-wow-delay="0.1s">
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-lg-7">
                    <div class="owl-carousel testimonial-carousel rounded p-5 wow zoomIn" data-wow-delay="0.6s">
                        <div class="testimonial-item text-center text-dark">
                            <img class="img-fluid mx-auto rounded mb-4" src="{% static 'img/testimonial-1.jpg' %}" alt="">
                            <p class="fs-5">Dolores sed duo clita justo dolor et stet lorem kasd dolore lorem ipsum. At lorem lorem magna ut et, nonumy labore diam erat. Erat dolor rebum sit ipsum.</p>
                            <hr class="mx-auto w-25">
                            <h4 class="text-dark mb-0">Client Name</h4>
                        </div>
                        <div class="testimonial-item text-center text-dark">
                            <img class="img-fluid mx-auto rounded mb-4" src="{% static 'img/testimonial-2.jpg' %}" alt="">
                            <p class="fs-5">Dolores sed duo clita justo dolor et stet lorem kasd dolore lorem ipsum. At lorem lorem magna ut et, nonumy labore diam erat. Erat dolor rebum sit ipsum.</p>
                            <hr class="mx-auto w-25">
                            <h4 class="text-dark mb-0">Client Name</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add these script tags to your HTML file -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="https://www.bing.com/api/maps/mapcontrol?key=Agyr0UQGWTFzP3Fwb3PDJ_ahP24jx9jRgpUWwBD_37B8MXu1oql6WCs6J-vgU1YT"></script>
    <script>
        $(document).ready(function() {
            $('#downloadReportButton').click(function() {
                $('#downloadReportModal').modal('show');
            });
        });
    </script>
    <script>
        $(document).ready(function() {
            // Function to initialize the map
            function initMap() {
                var map = new Microsoft.Maps.Map(document.getElementById("mapContainer"), {
                    credentials: "Agyr0UQGWTFzP3Fwb3PDJ_ahP24jx9jRgpUWwBD_37B8MXu1oql6WCs6J-vgU1YT",
                    zoom: 10,
                });
    
                // Add a marker for Kanjirappally
                var kanjirappallyLocation = new Microsoft.Maps.Location(9.6113, 76.7725);
                var marker = new Microsoft.Maps.Pushpin(kanjirappallyLocation, {
                    title: "MedBlood bank",
                    subTitle: "Kanjirappally, Kerala"
                });
                map.entities.push(marker);
            }
    
            // Hide the map container initially
            $('#mapContainer').hide();
            var mapInitialized = false;
    
            // Toggle the map container visibility on button click
            $('#findLabButton').click(function() {
                $('#mapContainer').toggle();
                // Initialize map if it's being shown and not initialized before
                if ($('#mapContainer').is(':visible') && !mapInitialized) {
                    initMap();
                    mapInitialized = true;
                }
            });
        });
    </script>
    <script>
        $(document).ready(function() {
            $('#searchButton').click(function() {
                var query = $('#searchInput').val().trim().toLowerCase();
                if (query !== '') {
                    $.ajax({
                        url: "{% url 'search_lab_tests' %}",
                        data: {
                            'query': query
                        },
                        dataType: 'json',
                        success: function(data) {
                            displaySearchResults(data);
                        }
                    });
                }
            });
    
            function displaySearchResults(results) {
                var searchResultsDropdown = $('#searchResults');
                searchResultsDropdown.empty();
                if (results.length > 0) {
                    for (var i = 0; i < results.length; i++) {
                        var test = results[i];
                        var testLink = $('<a>').attr('href', test.url).text(test.test_name);
                        var listItem = $('<li>').addClass('dropdown-item').append(testLink);
                        searchResultsDropdown.append(listItem);
                    }
                    searchResultsDropdown.show();
                } else {
                    searchResultsDropdown.hide();
                }
            }
        });
    </script>
    
    

{% endblock %}